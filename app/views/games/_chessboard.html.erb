<div id='game_notifications'>
  <h1 id='game_state'><%= @game.state %></h1>

  <% if @game.check?(@game.white_player) %>
    <h3 class='game_alerts'>
      <%= "#{@game.white_player.playername} is in check" %>
    </h3>
  <% end %>

  <% if @game.check?(@game.black_player) %>
    <h3 class='game_alerts'>
      <%= "#{@game.black_player.playername} is in check" %>
    </h3>
  <% end %>
</div>

  <table class='chessboard'>
    <% @chess_board.each_with_index do |row, y| %>
      <tr>
        <% row.each_with_index do |piece, x| %>
          <td  data-row=<%= y %> data-column=<%= x %>
            class=<%= (!piece.nil? && Pieces::Disabled.call(piece)) ? 'draggable' : 'droppable' %> >
            <div>
              <% if !piece.nil? %>
                <%= image_tag piece.picture,
                class: "piece",
                data: {
                  row: y,
                  column: x,
                  url: piece_path(piece)
                }
                %>
              <% end %>
            </div>
          </td>
        <% end %>
      </tr>
    <% end %>
  </table>

  <script type="text/javascript">
  	$(()=>{

  		$('.castle').click((e)=>{
  			$.ajax({
  				type: 'PUT',
  				url: $(e.target).data('url'),
  				data: { direction: $(e.target).data('direction') }
  			});
  		})

  		let droppable = (url) => {
  			$( ".droppable" ).droppable({
  				drop: (e)=>{
  					$.ajax({
  		        type: 'PUT',
  		        url: url,
  		        data: { row: $(e.target).data('row'), column: $(e.target).data('column') }
  		      });
  				}
  			});
  		}

  		$('.draggable .piece').draggable({
  			drag: (e) =>{
  				droppable($(e.target).data('url'));
  			}
  		});

  	});
  </script>
